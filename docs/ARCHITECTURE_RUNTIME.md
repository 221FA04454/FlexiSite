# ðŸ§ª FlexiSite Live Runtime Engine
## Architecture Specification (v1.7)

**Status**: implementation_plan  
**Role**: Principal Architect  
**Objective**: Provide a pixel-perfect, interactive "Live Mode" that simulates the published site experience directly within the builder environment.

---

### 1. Dual-Path Rendering Strategy
The system utilizes two distinct rendering pipelines to prevent "polluted" previews:

*   **Editor Pipeline**: Includes `EditorBlock`, drag handles, resize overlays, and node selection logic.
*   **Runtime Pipeline**: A "naked" render that only outputs semantic HTML + CSS Variables. 

### 2. Runtime Isolation (The Sandbox)
To ensure that builder styles (like the Indigo theme or Sidebar widths) do not bleed into the user's design, we implement a **Virtual Sandbox**:

1.  **Iframe Injection**: The preview is rendered inside a `srcDoc` iframe.
2.  **State Sync**: The latest `projectStore` and `themeStore` snapshots are passed to the iframe via `postMessage` or a shared memory object.
3.  **Variable Injection**: The iframe head receives the dynamic CSS variables generated by the **Theme Engine**.

### 3. Integrated Interaction Engine
In "Live Mode", the **Interaction Engine (v1.5)** is fully engaged:
*   **Navigation**: Clicking a navigation link triggers a `pushState` equivalent in the runtime store, swapping the active view without reloading the iframe.
*   **Visibility**: "Show/Hide" actions dynamically update the DOM within the sandbox.
*   **Preventing Editor Interception**: When `mode === 'live'`, the `DndContext` and `SelectionManager` are completely disabled to allow the browser's native event bubbling.

---

### ðŸš€ Implementation Workflow
1.  **Logic Separation**: Fork the `Renderer` into a lightweight `RuntimeRenderer.jsx`.
2.  **Sandbox Component**: Build `src/components/builder/PreviewIframe.jsx`.
3.  **UI Switch**: Implement the "Preview" toggle in the `BuilderToolbar` with a high-fidelity animation.
4.  **Local State Routing**: Create a mini-router for the preview mode that maps slugs to page IDs.
